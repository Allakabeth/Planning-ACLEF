\# PROJET ACLEF PLANNING V8



\## CONTEXTE CRITIQUE

Application de gestion de planning pour organisme de formation.

IMPORTANTE : Cette app FONCTIONNE. Ne pas tout refaire.



\## RÃˆGLES ABSOLUES

1\. \*\*JAMAIS modifier le code existant sans permission explicite\*\*

2\. \*\*TOUJOURS demander avant de refactorer\*\*

3\. \*\*JAMAIS coder en dur des donnÃ©es\*\*

4\. \*\*JAMAIS ajouter de fallbacks cachÃ©s\*\*

5\. \*\*Si tu ne comprends pas, DEMANDE. Ne devine pas.\*\*



\## TECHNOLOGIES UTILISÃ‰ES



&nbsp; Framework principal :

&nbsp; - Next.js 15.4.6 (avec support Turbopack pour le dev)

&nbsp; - React 19.1.0 (derniÃ¨re version)

&nbsp; - React DOM 19.1.0



&nbsp; Backend \& Base de donnÃ©es :

&nbsp; - Supabase (@supabase/supabase-js ^2.54.0) - BaaS PostgreSQL + Auth



&nbsp; Authentification \& SÃ©curitÃ© :

&nbsp; - bcryptjs ^3.0.2 - Hashage des mots de passe

&nbsp; - jsonwebtoken ^9.0.2 - Gestion des tokens JWT pour l'auth formateurs



&nbsp; Styling :

&nbsp; - CSS Modules (Home.module.css)

&nbsp; - CSS Global (globals.css)



&nbsp; Configuration :

&nbsp; - ES Modules (fichiers .mjs)

&nbsp; - React Strict Mode activÃ©



&nbsp; Environnement de dÃ©veloppement :

&nbsp; - Turbopack - Bundler nouvelle gÃ©nÃ©ration de Next.js

&nbsp; - Next.js Linting intÃ©grÃ©



\## STRUCTURE DU PROJET

&nbsp; projet-aclef-planning-v8/

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ pages/                          # Pages Next.js (routage automatique)

&nbsp; â”‚   â”œâ”€â”€ index.js                       # Dashboard principal admin

&nbsp; â”‚   â”œâ”€â”€ login.js                       # Login admin

&nbsp; â”‚   â”œâ”€â”€ planning-coordo.js             # Gestion planning coordination

&nbsp; â”‚   â”œâ”€â”€ gestion-apprenants.js          # Gestion apprenants

&nbsp; â”‚   â”œâ”€â”€ gestion-formateurs.js          # Gestion formateurs

&nbsp; â”‚   â”œâ”€â”€ gestion-lieux.js               # Gestion lieux

&nbsp; â”‚   â”œâ”€â”€ gestion-absences-formateur.js  # Gestion absences formateurs

&nbsp; â”‚   â”œâ”€â”€ absence-apprenant.js           # Gestion absences apprenants

&nbsp; â”‚   â”œâ”€â”€ valider-changements.js         # Validation modifications

&nbsp; â”‚   â”‚

&nbsp; â”‚   â”œâ”€â”€ ğŸ“ formateur/                  # Pages espace formateur

&nbsp; â”‚   â”‚   â”œâ”€â”€ index.js                   # Dashboard formateur

&nbsp; â”‚   â”‚   â”œâ”€â”€ login.js                   # Login formateur

&nbsp; â”‚   â”‚   â”œâ”€â”€ profil.js                  # Profil formateur

&nbsp; â”‚   â”‚   â”œâ”€â”€ change-password.js         # Changement mot de passe

&nbsp; â”‚   â”‚   â”œâ”€â”€ mon-planning-type.js       # Planning type personnel

&nbsp; â”‚   â”‚   â”œâ”€â”€ mon-planning-hebdo.js      # Planning hebdomadaire

&nbsp; â”‚   â”‚   â”œâ”€â”€ ma-presence.js             # Saisie prÃ©sences

&nbsp; â”‚   â”‚   â”œâ”€â”€ absence.js                 # DÃ©claration absences

&nbsp; â”‚   â”‚   â””â”€â”€ ma-messagerie.js           # Messagerie

&nbsp; â”‚   â”‚

&nbsp; â”‚   â”œâ”€â”€ ğŸ“ api/                        # Routes API Next.js

&nbsp; â”‚   â”‚   â”œâ”€â”€ admin-auth.js              # Auth admin

&nbsp; â”‚   â”‚   â”œâ”€â”€ auto-cleanup.js            # Nettoyage automatique

&nbsp; â”‚   â”‚   â”‚

&nbsp; â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/formateur/         # Auth formateurs (JWT)

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ login.js               # Login JWT

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ logout.js              # Logout

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ refresh.js             # Refresh token

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ verify.js              # VÃ©rification token

&nbsp; â”‚   â”‚   â”‚   â””â”€â”€ change-password.js     # Changement mot de passe

&nbsp; â”‚   â”‚   â”‚

&nbsp; â”‚   â”‚   â”œâ”€â”€ ğŸ“ admin/                  # Endpoints admin

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ presences-formateurs.js

&nbsp; â”‚   â”‚   â”‚   â”œâ”€â”€ absences-apprenants.js

&nbsp; â”‚   â”‚   â”‚   â””â”€â”€ reset-formateur-password.js

&nbsp; â”‚   â”‚   â”‚

&nbsp; â”‚   â”‚   â””â”€â”€ ğŸ“ formateur/              # Endpoints formateur

&nbsp; â”‚   â”‚       â”œâ”€â”€ presences.js

&nbsp; â”‚   â”‚       â””â”€â”€ update-password.js

&nbsp; â”‚   â”‚

&nbsp; â”‚   â””â”€â”€ \_app.js                        # App wrapper Next.js

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ components/                     # Composants React

&nbsp; â”‚   â”œâ”€â”€ MenuApprenants.js              # Menu sÃ©lection apprenants

&nbsp; â”‚   â”œâ”€â”€ MessagerieDashboard.js         # Interface messagerie

&nbsp; â”‚   â”œâ”€â”€ MessagerieSafeWrapper.js       # Wrapper sÃ©curisÃ© messagerie

&nbsp; â”‚   â”œâ”€â”€ withAuthAdmin.js               # HOC auth admin

&nbsp; â”‚   â”œâ”€â”€ withAuthFormateur.js           # HOC auth formateur

&nbsp; â”‚   â”‚

&nbsp; â”‚   â””â”€â”€ ğŸ“ assistance/                 # Composants d'aide

&nbsp; â”‚       â”œâ”€â”€ Absence.jsx

&nbsp; â”‚       â”œâ”€â”€ MonPlanningHebdo.jsx

&nbsp; â”‚       â”œâ”€â”€ MonPlanningType.jsx

&nbsp; â”‚       â””â”€â”€ PlanningFormateurType.jsx

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ lib/                            # Librairies et utilitaires

&nbsp; â”‚   â”œâ”€â”€ supabaseClient.js              # Client Supabase standard

&nbsp; â”‚   â”œâ”€â”€ supabaseAdmin.js               # Client Supabase admin (service role)

&nbsp; â”‚   â”œâ”€â”€ AuthContext.js                 # Contexte auth admin

&nbsp; â”‚   â”œâ”€â”€ jwt.js                         # Gestion JWT

&nbsp; â”‚   â”œâ”€â”€ auditLogger.js                 # Logger d'audit

&nbsp; â”‚   â””â”€â”€ absenceApprenantUtils.js       # Utils absences

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ contexts/                       # Contextes React

&nbsp; â”‚   â””â”€â”€ FormateurAuthContext.js        # Contexte auth formateur JWT

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ styles/                         # Styles CSS

&nbsp; â”‚   â”œâ”€â”€ globals.css                    # Styles globaux

&nbsp; â”‚   â””â”€â”€ Home.module.css                # Module CSS

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ public/                         # Assets statiques

&nbsp; â”‚   â”œâ”€â”€ favicon.ico

&nbsp; â”‚   â””â”€â”€ \*.svg                          # IcÃ´nes SVG

&nbsp; â”‚

&nbsp; â”œâ”€â”€ ğŸ“ Scripts utilitaires (racine)/   # Scripts .mjs de maintenance

&nbsp; â”‚   â”œâ”€â”€ check-\*.mjs                    # Scripts de vÃ©rification

&nbsp; â”‚   â”œâ”€â”€ debug-\*.mjs                    # Scripts de debugging

&nbsp; â”‚   â”œâ”€â”€ clean-\*.mjs                    # Scripts de nettoyage

&nbsp; â”‚   â”œâ”€â”€ test-\*.mjs                     # Scripts de test

&nbsp; â”‚   â”œâ”€â”€ verify-\*.mjs                   # Scripts de vÃ©rification

&nbsp; â”‚   â”œâ”€â”€ audit-\*.js                     # Scripts d'audit

&nbsp; â”‚   â””â”€â”€ \*.sql                          # Scripts SQL (RLS, tables)

&nbsp; â”‚

&nbsp; â”œâ”€â”€ middleware.js                      # Middleware Next.js

&nbsp; â”œâ”€â”€ package.json                       # DÃ©pendances npm

&nbsp; â”œâ”€â”€ next.config.mjs                    # Config Next.js

&nbsp; â”œâ”€â”€ .env.local                         # Variables d'environnement (non versionnÃ©)

&nbsp; â””â”€â”€ .gitignore



&nbsp; Architecture :

&nbsp; - Authentification double : Admin (hardcodÃ©) + Formateur (JWT)

&nbsp; - API Routes : Next.js API routes pour backend

&nbsp; - Base de donnÃ©es : Supabase PostgreSQL

&nbsp; - SÃ©curitÃ© : RLS, bcrypt, JWT

&nbsp; - Scripts : +30 scripts utilitaires pour maintenance BDD



\## ERREURS Ã€ NE PLUS JAMAIS RÃ‰PÃ‰TER

\- Casser la base de donnÃ©es

\- Refaire le design sans sauvegarder

\- Ajouter des fonctionnalitÃ©s non demandÃ©es

\- Modifier plusieurs fichiers Ã  la fois



\## MA MÃ‰THODE DE TRAVAIL

1\. Je dÃ©cris CE QUE je veux (pas comment)

2\. Tu me proposes UN SEUL fichier Ã  modifier

3\. Tu me montres EXACTEMENT ce que tu vas changer

4\. J'approuve ou je refuse

5\. Tu modifies UN SEUL fichier

6\. On teste

7\. On passe au suivant





\## REGLES Ã€ SUIVRE



1\. RÃ©flÃ©chis d'abord au problÃ¨me, lis le code source pour trouver les fichiers pertinents et rÃ©dige un plan dans tasks/todo.md.

2\. Ce plan doit contenir une liste de tÃ¢ches Ã  effectuer que tu peux cocher au fur et Ã  mesure de leur exÃ©cution.

3\. Avant de commencer, demande-moi pour que je vÃ©rifie le plan.

4\. Commence ensuite Ã  travailler sur les tÃ¢ches Ã  effectuer, en les marquant comme terminÃ©es au fur et Ã  mesure.

5\. Ã€ chaque Ã©tape veille Ã  me fournir une explication dÃ©taillÃ©e des modifications que tu as apportÃ©es.

6\. Simplifie au maximum chaque tÃ¢che et modification de code. Nous souhaitons Ã©viter les modifications massives ou complexes. Chaque modification doit avoir un impact minimal sur le code. Tout est une question de simplicitÃ©.

7\. Enfin, ajoute une section de rÃ©vision au fichier todo.md avec un rÃ©sumÃ© des modifications apportÃ©es et toute autre information pertinente.

8\. NE SOIS PAS PARESSEUX. NE SOIS JAMAIS PARESSEUX. EN CAS DE BUG, â€‹â€‹TROUVE-EN LA CAUSE ET CORRIGE-LA. Pas de correctifs temporaires. Tu es un dÃ©veloppeur senior. Ne sois jamais paresseux.

9\. Simplifie au maximum les correctifs et les modifications de code. Ils ne doivent affecter que le code nÃ©cessaire Ã  la tÃ¢che et rien d'autre. Ils doivent avoir le moins d'impact possible sur le code. Ton objectif est de ne pas introduire de bugs. La simplicitÃ© est primordiale.





\## QUAND JE DIS "STOP"

Tu arrÃªtes immÃ©diatement. Tu ne finis pas ta phrase.

Tu ne "corriges" pas une derniÃ¨re chose.

ESSENTIEL : Lors du dÃ©bogage, il est impÃ©ratif de suivre l'intÃ©gralitÃ© du flux de code, Ã©tape par Ã©tape. Sans hypothÃ¨ses ni raccourcis.

